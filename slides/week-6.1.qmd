---
title: Describing Distributions
date: today
date-format: long
footer: "[IAFF 6501 Website](https://quant4ia.rocks/)"
logo: images/iaff6501-logo.png
format:
  revealjs:
    theme: [simple, custom.scss]
    transition: fade
    slide-number: true
    #multiplex: true
    chalkboard: true
execute:
  echo: false
  message: false
  warning: false
  freeze: auto
---

```{r}
#| label: setup
#| include: false

# Load packages 
library(vdemdata)
library(tidyverse)
library(countdown)

# Create dataset for year 2022, with country name, year, and electoral dem
vdem2022 <- vdem |>
  filter(year == 2022)  |>
  select(
    country = country_name, 
    year, 
    polyarchy = v2x_polyarchy, 
    region = e_regionpol_6C 
    ) |>
  mutate(region = case_match(region, 
                        1 ~ "Eastern Europe", 
                        2 ~ "Latin America",  
                        3 ~ "Middle East",   
                        4 ~ "Africa", 
                        5 ~ "The West", 
                        6 ~ "Asia")) 
```

# Measuring Spread

## Why Measure and Visualize Spread?

```{r}
#| label: spread

library(patchwork)

x <- tibble(x = rnorm(1000, mean = 0, 2))
a <- ggplot(x, aes(x = x )) +
  geom_histogram(binwidth = .5, fill = "steelblue") + theme_bw() +
   labs(
    x = "A made up measure", 
    y = "Frequency", 
    title = "A Distribution with Mean = 0"
  ) + xlim(-20, 20)
x <- tibble(x = rnorm(1000,mean = 0, 10))
b <- ggplot(x, aes(x = x )) +
  geom_histogram(binwidth = .5, fill = "steelblue") + theme_bw() +
   labs(
    x = "A made up measure", 
    y = "Frequency", 
    title = "A Distribution with Mean = 0"
  ) + xlim(-20, 20)
a + b
```

# IQR

## What is a Range?

<br>

-   Range (min and max values)
-   Not ideal b/c does not tell us much about where most of the values are located

```{r}
#| label: min-max
#| echo: true

vdem2022 |>
  summarize(min = min(polyarchy),
            max = max(polyarchy))
```

## Interquartile Range

IQR: 25th percentile - 75th percentile

```{r}
#| echo: false
#| fig-align: center

low <- quantile(vdem2022$polyarchy, .25)
high <- quantile(vdem2022$polyarchy, .75)
ggplot(vdem2022, aes(x = polyarchy )) +
  geom_histogram(binwidth = .05, fill = "steelblue") + theme_bw() +
   labs(
    x = "Electoral Democracy", 
    y = "Frequency", 
    title = "Distribution of Electoral Democracy in 2022", 
    caption = "Source: V-Dem Institute"
  ) + 
  geom_vline(xintercept = low, linewidth = 2, color = "darkorange") + 
  geom_vline(xintercept = high, linewidth = 2, color = "darkorange") 
```

## Interquartile Range

- The middle 50 percent of the countries in the data lie between 0.262 and 0.747
- The IQR (0.485) is the difference between the Q3 and Q1 values 

```{r}
#| label: iqr
#| echo: true

vdem2022 %>% 
  summarize(IQRlow =  quantile(polyarchy, .25),
            IQRhigh = quantile(polyarchy, .75),
            IQRlength = IQR(polyarchy)
          )
```

## Box Plot

<br>

- A box plot is a graphical representation of the distribution based on the median and quartiles
- It is a standardized way of displaying the distribution of data based on a five number summary: minimum, first quartile, median, third quartile, and maximum

## Box Plot

```{r}
#| label: boxplot
#| echo: true
#| code-fold: true
#| fig-align: center

ggplot(vdem2022, aes(x = "", y = polyarchy)) +
  geom_boxplot(fill = "steelblue") + 
   labs(
    x = "", 
    y = "Electoral Democracy", 
    title = "Distribution of Electoral Democracy in 2022", 
    caption = "Source: V-Dem Institute"
  ) +
  theme_minimal()
```

# Standard Deviation

## Measure of Spead: Standard Deviation

<br>

-   Can think of it as something like the "average distance" of each data point from the mean

```{r echo=TRUE}
vdem2022 |>
  summarize(mean = mean(polyarchy),
            stdDev = sd(polyarchy))
```

## Standard Deviation

<br>

- A low standard deviation indicates that the values tend to be close to the mean
- A high standard deviation indicates that the values are spread out over a wider range

## Starting with Variance

<br>

- Variance is a step towards calculating the standard deviation.
- It quantifies the average squared deviation of each number from the mean of the data set.

## Calculating Deviation from the Mean

- First, calculate the mean ($\bar{X}$) of the dataset.
- For each data point ($X_i$), calculate its deviation from the mean: $$e_i = X_i - \bar{X}$$
  - Example with a mean of 5:
    - For a data point where $(X_i = 0): (0 - 5 = -5)$
    - For a data point where $(X_i = 10): (10 - 5 = 5)$

## Squaring the Deviations

- Squaring each deviation ($e_i$) to eliminate negative values: $$e_i^2 = (X_i - \bar{X})^2$$
- Summing up all squared deviations: $$\sum_{i=1}^{n} (X_i - \bar{X})^2$$
- This sum represents the total squared deviation from the mean.

## Calculating the Variance

<br>

- Divide the total squared deviation by $(n-1)$ (to account for the sample variance): $$\text{Variance} = \frac{1}{n-1} \sum_{i=1}^{n} (X_i - \bar{X})^2$$
- Using $(n-1)$ ensures an unbiased estimate of the population variance when calculating from a sample.

## Deriving the Standard Deviation

<br>

- The standard deviation is the square root of the variance: $$s = \sqrt{\frac{1}{n-1} \sum_{i=1}^{n} (X_i - \bar{X})^2}$$
- Taking the square root converts the variance back to the units of the original data.

## Standard Deviation Simple Example

<br>

```{r}
#| label: std-dev-1
#| echo: true
x = c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
e <- x - mean(x)
e
```

## Standard Deviation Simple Example

<br>

```{r}
#| label: std-dev-2
#| echo: true
x = c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
e_squared <- e^2
e_squared
```

## Standard Deviation Simple Example

<br>

```{r}
#| label: std-dev-3
#| echo: true
x = c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
sum_e_squared <- sum(e_squared)
sum_e_squared
```

## Standard Deviation Simple Example

<br>

```{r}
#| label: std-dev-4
#| echo: true
variance <- sum_e_squared/(length(x)-1)
variance
```

## Standard Deviation Simple Example

<br>

```{r}
#| label: std-dev-5
#| echo: true
standard_dev <- sqrt(variance)
standard_dev
sd(x)
```

## Your Turn!

<br>

- Calculate measures of spread for the `polyarchy` variable in the V-Dem data (mean, median, IQR, standard deviation)
- How would you interpret these measures?
- Try a box plot for the `polyarchy` variable
- Try another variable in the V-Dem data
- How does it compare to `polyarchy`?


```{r}
#| label: timer2

countdown(minutes = 5, 
          id = "timer2", 
          bottom = "10%", 
          right = "10%")
```

# Groups

## Calculating Statistics by groups

<br>

-   What if we want to describe electoral democracy and see how it differs by some different variable? For example, by world region, or by year?
-   In this case we want to combine numerical summaries with categorical variables
-   This brings us back to bar chart

## Calculating Statistics by Groups

-   Let's calculate the mean and median of electoral democracy in each world region
-   For this, we add the *group_by()* to our previous code

```{r}
#| label: group-by-1
#| echo: true
#| code-line-numbers: "2"
vdem2022 |>
  group_by(region) |>
  summarize(mean_dem = mean(polyarchy),
            median_dem = median(polyarchy))
```

## Calculating Statistics by Groups

-   Let's store our statistics as a new data object, *democracy_region*

```{r}
#| label: group-by-2
#| echo: true
#| code-line-numbers: "1"
democracy_region <- vdem2022 |> 
  group_by(region) |>
  summarize(mean_dem = mean(polyarchy),
            median_dem = median(polyarchy))

democracy_region
```

## Visualize using our Bar Chart Skills

```{r}
#| label: group-by-3
#| echo: true
#| code-fold: true
ggplot(democracy_region, aes(x = reorder(region, -mean_dem), y = mean_dem)) +
  geom_col(fill = "steelblue") + 
  labs(
    x = "Region", 
    y = "Mean Polyarchy Score", 
    title = "Democracy by region, 1990 - present", 
    caption = "Source: V-Dem Institute"
    ) + 
  theme_minimal()
```

## Numerical Variable by Group

How should we interpret this plot?
```{r}
#| label: ridge-plot
#| echo: true
#| code-fold: true
library(ggridges)
#library(forcats)
  ggplot(vdem2022, aes(x = polyarchy, y = region, fill = region)) +
    geom_density_ridges() +
  labs(
    x = "Electoral Democracy",
    y = "Region",
    title = "A Ridge Plot",
    caption = "Source: V-Dem Institute",
  ) +
  scale_fill_viridis_d() +
  theme_minimal()
```

## Your Turn!

<br>

- Make a bar chart summarizing `polyarchy` or some other V-Dem variable
- Now try your hand at a ridge plot

```{r}
#| label: timer3

countdown(minutes = 5, 
          id = "timer3", 
          bottom = "10%", 
          right = "10%")
```
